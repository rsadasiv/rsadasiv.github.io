<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WordnetUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">OOP Core NLP</a> &gt; <a href="index.source.html" class="el_package">io.outofprintmagazine.nlp.utils</a> &gt; <span class="el_source">WordnetUtils.java</span></div><h1>WordnetUtils.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright (C) 2020 Ram Sadasiv
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 ******************************************************************************/
package io.outofprintmagazine.nlp.utils;

import java.io.IOException;
import java.math.BigDecimal;
import java.net.URL;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedHashSet;
import java.util.List;
import java.util.Map;
import java.util.Set;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import edu.mit.jverbnet.data.IMember;
import edu.mit.jverbnet.data.IVerbClass;
import edu.mit.jverbnet.data.IWordnetKey;
import edu.mit.jverbnet.index.IVerbIndex;
import edu.mit.jverbnet.index.VerbIndex;
import edu.mit.jwi.Dictionary;
import edu.mit.jwi.IDictionary;
import edu.mit.jwi.item.IIndexWord;
import edu.mit.jwi.item.ISenseKey;
import edu.mit.jwi.item.ISynset;
import edu.mit.jwi.item.ISynsetID;
import edu.mit.jwi.item.IWord;
import edu.mit.jwi.item.IWordID;
import edu.mit.jwi.item.POS;
import edu.mit.jwi.item.Pointer;
import edu.stanford.nlp.ling.CoreLabel;
import io.outofprintmagazine.util.ParameterStore;


public class WordnetUtils {

<span class="fc" id="L55">	private static final Logger logger = LogManager.getLogger(WordnetUtils.class);</span>
	
<span class="fc" id="L57">	private IDictionary wordnet = null;</span>
<span class="fc" id="L58">	private HashMap&lt;String, ArrayList&lt;String&gt;&gt; verbnet = new HashMap&lt;String, ArrayList&lt;String&gt;&gt;();</span>
<span class="fc" id="L59">	private ParameterStore parameterStore = null;</span>

	
	
<span class="fc" id="L63">	private WordnetUtils(ParameterStore parameterStore) throws IOException {</span>
<span class="fc" id="L64">		wordnet = new Dictionary(</span>
				new URL(
						&quot;file&quot;, 
						null, 
<span class="fc" id="L68">						parameterStore.getProperty(</span>
								&quot;wordNet_location&quot;
						)
//						&quot;C:\\Users\\rsada\\eclipse-workspace\\oopcorenlp\\data\\wn3.1.dict\\dict&quot;
				)
		);
<span class="fc" id="L74">		wordnet.open();</span>
<span class="fc" id="L75">		this.parameterStore = parameterStore;</span>
<span class="fc" id="L76">	}</span>
	
<span class="fc" id="L78">	private static Map&lt;ParameterStore, WordnetUtils&gt; instances = new HashMap&lt;ParameterStore, WordnetUtils&gt;();</span>
	
    public static WordnetUtils getInstance(ParameterStore parameterStore) throws IOException { 
<span class="fc bfc" id="L81" title="All 2 branches covered.">        if (instances.get(parameterStore) == null) {</span>
<span class="fc" id="L82">        	WordnetUtils instance = new WordnetUtils(parameterStore);</span>
<span class="fc" id="L83">            instances.put(parameterStore, instance);</span>
        }
<span class="fc" id="L85">        return instances.get(parameterStore); </span>
    }
    
	public IDictionary getWordnet() {
<span class="fc" id="L89">		return wordnet;</span>
	}
	
	public ArrayList&lt;String&gt; getVerbnetSenses(ISenseKey senseKey) throws IOException {
<span class="pc bpc" id="L93" title="2 of 4 branches missed.">		if (senseKey != null &amp;&amp; senseKey.toString().length() &gt; 2) {</span>
<span class="fc" id="L94">			return getVerbnetSenses(senseKey.toString().substring(0, senseKey.toString().length()-2));</span>
		}
<span class="nc" id="L96">		return new ArrayList&lt;String&gt;();</span>
	}
	
	public ArrayList&lt;String&gt; getVerbnetSenses(String senseKey) throws IOException {
		//logger.debug(&quot;checking: &quot; + senseKey);
<span class="fc" id="L101">		ArrayList&lt;String&gt; retval = getVerbnet().get(senseKey);</span>
<span class="fc" id="L102">		return retval;</span>
	}
	
	private HashMap&lt;String, ArrayList&lt;String&gt;&gt; getVerbnet() throws IOException {
<span class="fc bfc" id="L106" title="All 2 branches covered.">		if (verbnet.size() == 0) {</span>
<span class="fc" id="L107">			initVerbnet();</span>
		}
<span class="fc" id="L109">		return verbnet;</span>
	}
	
	private void initVerbnet() throws IOException {
<span class="fc" id="L113">		IVerbIndex index = new VerbIndex(</span>
				new URL(
						&quot;file&quot;, 
						null, 
<span class="fc" id="L117">						parameterStore.getProperty(</span>
								&quot;verbNet_location&quot;
						)
//						&quot;C:\\Users\\rsada\\eclipse-workspace\\oopcorenlp\\data\\new_vn\\&quot;
				)
		);
<span class="fc" id="L123">		index.open();</span>
<span class="fc" id="L124">		Iterator&lt;IVerbClass&gt; verbClassIter = index.iteratorRoots();</span>
<span class="fc bfc" id="L125" title="All 2 branches covered.">		while (verbClassIter.hasNext()) {</span>
<span class="fc" id="L126">			IVerbClass verb = verbClassIter.next();</span>
<span class="fc bfc" id="L127" title="All 2 branches covered.">			for (IMember member : verb.getMembers()) {</span>
<span class="fc bfc" id="L128" title="All 2 branches covered.">				for (IWordnetKey senseKey : member.getWordnetTypes().keySet()) {</span>
<span class="fc" id="L129">					ArrayList&lt;String&gt; senseKeyList = verbnet.get(senseKey.toString());</span>
<span class="fc bfc" id="L130" title="All 2 branches covered.">					if (senseKeyList == null) {</span>
<span class="fc" id="L131">						senseKeyList = new ArrayList&lt;String&gt;();</span>
					}
<span class="fc" id="L133">					senseKeyList.add(verb.getID());</span>
<span class="fc" id="L134">					verbnet.put(senseKey.toString(), senseKeyList);</span>
					//logger.debug(&quot;loaded &quot; + senseKey.toString() + &quot; size &quot; + senseKeyList.size());
<span class="fc" id="L136">				}</span>
<span class="fc" id="L137">			}</span>
			
<span class="fc" id="L139">		}	</span>
<span class="fc" id="L140">	}</span>
	
	private POS tagToPOS(CoreLabel token) {
<span class="fc" id="L143">		POS wnPos = null;</span>
<span class="fc bfc" id="L144" title="All 2 branches covered.">		if (token.tag().startsWith(&quot;N&quot;)) {</span>
<span class="fc" id="L145">			wnPos = POS.NOUN;</span>
		}
<span class="fc bfc" id="L147" title="All 2 branches covered.">		else if (token.tag().startsWith(&quot;V&quot;)) {</span>
<span class="fc" id="L148">			wnPos = POS.VERB;</span>
		}
<span class="fc bfc" id="L150" title="All 2 branches covered.">		else if (token.tag().startsWith(&quot;J&quot;)) {</span>
<span class="fc" id="L151">			wnPos = POS.ADJECTIVE;</span>
		}
<span class="pc bpc" id="L153" title="1 of 2 branches missed.">		else if (token.tag().equals(&quot;DT&quot;)) {</span>
<span class="nc" id="L154">			wnPos = POS.ADJECTIVE;</span>
		}
<span class="fc bfc" id="L156" title="All 2 branches covered.">		else if (token.tag().startsWith(&quot;R&quot;)) {</span>
<span class="fc" id="L157">			wnPos = POS.ADVERB;</span>
		}
<span class="fc" id="L159">		return wnPos;</span>
	}
	

	private String getLexicalFileName(CoreLabel token) {
<span class="nc" id="L164">		String score = null;</span>
<span class="nc" id="L165">		POS pos = tagToPOS(token);</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">		if (pos == null) {</span>
<span class="nc" id="L167">			return score;</span>
		}
				
			try {
<span class="nc" id="L171">				IIndexWord idxWord = getWordnet().getIndexWord(token.lemma(), tagToPOS(token));</span>
<span class="nc bnc" id="L172" title="All 4 branches missed.">				if (idxWord != null &amp;&amp; idxWord.getWordIDs().size() &gt; 0) {</span>
<span class="nc" id="L173">					IWordID wordID = idxWord.getWordIDs().get(0);</span>
<span class="nc" id="L174">					IWord word = getWordnet().getWord(wordID);</span>
<span class="nc" id="L175">					score = word.getSynset().getLexicalFile().getName();</span>
				}
			}
<span class="nc" id="L178">			catch (Exception e) {</span>
<span class="nc" id="L179">				logger.error(token.toString(), e);</span>
<span class="nc" id="L180">			}</span>


<span class="nc" id="L183">		return score;</span>
	}
	
	public String getLexicalFileName(CoreLabel token, List&lt;CoreLabel&gt; contextWords) {
<span class="fc" id="L187">		String score = null;</span>
<span class="fc" id="L188">		POS pos = tagToPOS(token);</span>
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">		if (pos == null) {</span>
<span class="nc" id="L190">			return score;</span>
		}
	
			try {
<span class="fc" id="L194">				IIndexWord idxWord = getWordnet().getIndexWord(token.lemma(), tagToPOS(token));</span>
<span class="pc bpc" id="L195" title="2 of 4 branches missed.">				if (idxWord != null &amp;&amp; idxWord.getWordIDs().size() &gt; 0) {</span>
<span class="fc" id="L196">					ISenseKey senseKey = getTargetWordSenseKey(token, contextWords);</span>
<span class="pc bpc" id="L197" title="1 of 2 branches missed.">					for (IWordID wordID : idxWord.getWordIDs()) {</span>
<span class="fc" id="L198">						IWord word = getWordnet().getWord(wordID);</span>
<span class="fc bfc" id="L199" title="All 2 branches covered.">						if (word.getSenseKey().equals(senseKey)) {</span>
<span class="fc" id="L200">							score = word.getSynset().getLexicalFile().getName();</span>
<span class="fc" id="L201">							break;</span>
						}
<span class="fc" id="L203">					}</span>
				}
			}
<span class="nc" id="L206">			catch (Exception e) {</span>
<span class="nc" id="L207">				logger.error(token.toString(), e);</span>
<span class="fc" id="L208">			}</span>

		
<span class="fc" id="L211">		return score;</span>
	}
	
	public IIndexWord getIndexWord(CoreLabel token) {
<span class="fc" id="L215">		IIndexWord retval = null;</span>

<span class="fc bfc" id="L217" title="All 2 branches covered.">			if (tagToPOS(token) != null) {</span>
<span class="fc" id="L218">				retval = getWordnet().getIndexWord(token.lemma(), tagToPOS(token));</span>
			}
<span class="pc bpc" id="L220" title="3 of 8 branches missed.">			if ((token.tag().equals(&quot;JJR&quot;) || token.tag().equals(&quot;RBR&quot;)) &amp;&amp; token.lemma().endsWith(&quot;er&quot;) &amp;&amp; token.lemma().length() &gt; 2) {</span>
<span class="fc" id="L221">				retval = getWordnet().getIndexWord(token.lemma().substring(0, token.lemma().length()-2 ), tagToPOS(token));</span>
			}
<span class="pc bpc" id="L223" title="6 of 8 branches missed.">			if ((token.tag().equals(&quot;JJS&quot;) || token.tag().equals(&quot;RBS&quot;)) &amp;&amp; token.lemma().endsWith(&quot;est&quot;) &amp;&amp; token.lemma().length() &gt; 3) {</span>
<span class="nc" id="L224">				retval = getWordnet().getIndexWord(token.lemma().substring(0, token.lemma().length()-3 ), tagToPOS(token));</span>
			}
<span class="fc bfc" id="L226" title="All 2 branches covered.">			if (retval == null) {</span>
<span class="fc" id="L227">				retval = getWordnet().getIndexWord(token.lemma(), POS.NOUN);</span>
			}
<span class="fc bfc" id="L229" title="All 2 branches covered.">			if (retval == null) {</span>
<span class="fc" id="L230">				retval = getWordnet().getIndexWord(token.lemma(), POS.VERB);</span>
			}
<span class="fc bfc" id="L232" title="All 2 branches covered.">			if (retval == null) {</span>
<span class="fc" id="L233">				retval = getWordnet().getIndexWord(token.lemma(), POS.ADJECTIVE);</span>
				
			}
<span class="fc bfc" id="L236" title="All 2 branches covered.">			if (retval == null) {</span>
<span class="fc" id="L237">				retval = getWordnet().getIndexWord(token.lemma(), POS.ADVERB);</span>
			}

<span class="fc" id="L240">		return retval;</span>
	}
	
	public Map&lt;String,BigDecimal&gt; scoreTokenHypernym(CoreLabel token, List&lt;CoreLabel&gt; contextWords, Map&lt;String,BigDecimal&gt; tokensToMatch) {
<span class="fc" id="L244">		Map&lt;String,BigDecimal&gt; retval = new HashMap&lt;String,BigDecimal&gt;();</span>
<span class="fc" id="L245">		POS pos = tagToPOS(token);</span>
<span class="pc bpc" id="L246" title="1 of 2 branches missed.">		if (pos == null) {</span>
<span class="nc" id="L247">			return retval;</span>
		}
				
		try {
<span class="fc" id="L251">			IIndexWord idxWord = getIndexWord(token);</span>
<span class="pc bpc" id="L252" title="2 of 4 branches missed.">			if (idxWord != null &amp;&amp; idxWord.getWordIDs().size() &gt; 0) {</span>
<span class="fc" id="L253">				ISenseKey senseKey = getTargetWordSenseKey(token, contextWords);</span>
<span class="pc bpc" id="L254" title="1 of 2 branches missed.">				for (IWordID wordID : idxWord.getWordIDs()) {</span>
<span class="fc" id="L255">					IWord word = getWordnet().getWord(wordID);</span>
<span class="fc bfc" id="L256" title="All 2 branches covered.">					if (word.getSenseKey().equals(senseKey)) {</span>
<span class="fc" id="L257">						List&lt;ISynsetID&gt; hypernyms = word.getSynset().getRelatedSynsets(Pointer.HYPERNYM);</span>
<span class="fc" id="L258">						IWord bestHypernymWord = null;</span>
<span class="fc" id="L259">						BigDecimal bestHypernymScore = new BigDecimal(-1);</span>
<span class="fc bfc" id="L260" title="All 2 branches covered.">						for (int i=0;i&lt;hypernyms.size();i++) {</span>
<span class="fc bfc" id="L261" title="All 2 branches covered.">							for (IWord hypernymWord : getWordnet().getSynset(hypernyms.get(i)).getWords()) {</span>
<span class="fc bfc" id="L262" title="All 2 branches covered.">								if (i==0) {</span>
<span class="fc" id="L263">									bestHypernymWord = hypernymWord;</span>
								}
								try {
									//what does this mean?
									//retval.put(hypernymWord.getLemma(), new BigDecimal(hypernyms.size()-i));
<span class="fc" id="L268">									BigDecimal hypernymScore = new BigDecimal(0);</span>
<span class="fc" id="L269">									List&lt;ISynsetID&gt; hyponyms = hypernymWord.getSynset().getRelatedSynsets(Pointer.HYPONYM);</span>
<span class="fc bfc" id="L270" title="All 2 branches covered.">									for (int j=0;j&lt;hyponyms.size();j++) {</span>
										//logger.debug(&quot;hyponyms&quot;);
<span class="fc bfc" id="L272" title="All 2 branches covered.">										for (IWord hyponymWord : getWordnet().getSynset(hyponyms.get(j)).getWords()) {</span>
											//logger.debug(&quot;hyponym synset lemma:&quot; + hyponymWord.getLemma());
<span class="fc bfc" id="L274" title="All 2 branches covered.">											if (tokensToMatch.containsKey(hyponymWord.getLemma())) {</span>
<span class="fc" id="L275">												hypernymScore.add(tokensToMatch.get(hyponymWord.getLemma()));</span>
											}
<span class="fc" id="L277">										}</span>
									}
<span class="pc bpc" id="L279" title="1 of 2 branches missed.">									if (hypernymScore.compareTo(bestHypernymScore) &gt; 0) {</span>
<span class="fc" id="L280">										bestHypernymWord = hypernymWord;</span>
									}
								}
<span class="nc" id="L283">								catch (Throwable t) {</span>
<span class="nc" id="L284">									logger.debug(t);</span>
<span class="fc" id="L285">								}</span>
<span class="fc" id="L286">							}</span>
						}
<span class="fc bfc" id="L288" title="All 2 branches covered.">						if (bestHypernymWord != null) {</span>
<span class="fc" id="L289">							retval.put(bestHypernymWord.getLemma(), new BigDecimal(1));</span>
						}
						break;
					}
<span class="fc" id="L293">				}</span>
			}
		}
<span class="nc" id="L296">		catch (Exception e) {</span>
<span class="nc" id="L297">			logger.error(token.toString(), e);</span>
<span class="fc" id="L298">		}</span>

<span class="fc" id="L300">		return retval;</span>
	}
	
	public String getTokenGloss(CoreLabel token, List&lt;CoreLabel&gt; contextWords) {
<span class="fc" id="L304">		String retval = null;</span>
<span class="fc" id="L305">		POS pos = tagToPOS(token);</span>
<span class="fc bfc" id="L306" title="All 2 branches covered.">		if (pos == null) {</span>
<span class="fc" id="L307">			return retval;</span>
		}
					
			try {
<span class="fc" id="L311">				IIndexWord idxWord = getIndexWord(token);</span>
<span class="pc bpc" id="L312" title="1 of 4 branches missed.">				if (idxWord != null &amp;&amp; idxWord.getWordIDs().size() &gt; 0) {</span>
<span class="fc" id="L313">					ISenseKey senseKey = getTargetWordSenseKey(token, contextWords);</span>
<span class="pc bpc" id="L314" title="1 of 2 branches missed.">					for (IWordID wordID : idxWord.getWordIDs()) {</span>
<span class="fc" id="L315">						IWord word = getWordnet().getWord(wordID);</span>
<span class="fc bfc" id="L316" title="All 2 branches covered.">						if (word.getSenseKey().equals(senseKey)) {</span>
<span class="fc" id="L317">							retval = word.getSynset().getGloss();</span>
<span class="fc" id="L318">							break;</span>
						}
<span class="fc" id="L320">					}</span>
				}
			}
<span class="nc" id="L323">			catch (Exception e) {</span>
<span class="nc" id="L324">				logger.error(token.toString(), e);</span>
<span class="fc" id="L325">			}</span>

<span class="fc" id="L327">		return retval;</span>
	}
	
	
	public ISenseKey getTargetWordSenseKey(CoreLabel targetWord, List&lt;CoreLabel&gt; contextWords) throws IOException, InstantiationException, IllegalAccessException, ClassNotFoundException {
<span class="fc" id="L332">		POS pos = tagToPOS(targetWord);</span>
<span class="pc bpc" id="L333" title="1 of 2 branches missed.">		if (pos == null) {</span>
<span class="nc" id="L334">			return null;</span>
		}
<span class="fc" id="L336">		ISenseKey retval = getTargetWordSenseKeyPOS(pos, targetWord, contextWords);</span>
<span class="pc bpc" id="L337" title="3 of 4 branches missed.">		if (retval == null &amp;&amp; pos.compareTo(POS.ADJECTIVE) == 0) {</span>
<span class="nc" id="L338">			retval = getTargetWordSenseKeyPOS(POS.VERB, targetWord, contextWords);</span>
		}
<span class="fc" id="L340">		return retval;</span>
	}

	public ISenseKey getTargetWordSenseKeyPOS(POS pos, CoreLabel targetWord, List&lt;CoreLabel&gt; contextWords) throws IOException, InstantiationException, IllegalAccessException, ClassNotFoundException {
	
			//look up the target word
<span class="fc" id="L346">			IIndexWord idxWord = getWordnet().getIndexWord(targetWord.lemma(), pos);	</span>
<span class="pc bpc" id="L347" title="1 of 2 branches missed.">			if (idxWord != null) {</span>
<span class="fc" id="L348">				IWord word0 = getWordnet().getWord(idxWord.getWordIDs().get(0));</span>
				//if the target word only has one sense, return it
<span class="fc bfc" id="L350" title="All 2 branches covered.">				if (idxWord.getWordIDs().size() == 1) {</span>
					//logger.debug(&quot;returning only sense: &quot; + targetWord);
<span class="fc" id="L352">					return word0.getSenseKey();</span>
				}
				//if the top ranked sense is more than 2 times as likely as the second ranked sense, return the top ranked sense
<span class="fc" id="L355">				IWord word1 = getWordnet().getWord(idxWord.getWordIDs().get(1));</span>
<span class="fc bfc" id="L356" title="All 2 branches covered.">				if (getWordnet().getSenseEntry(word1.getSenseKey()).getTagCount() &lt; (getWordnet().getSenseEntry(word0.getSenseKey()).getTagCount()/2)) {</span>
					//logger.debug(&quot;returning dominant sense: &quot; + targetWord);
<span class="fc" id="L358">					return word0.getSenseKey();</span>
				}
				else {
<span class="fc" id="L361">					ISenseKey k = simplifiedLesk(targetWord, contextWords);</span>
					//logger.debug(&quot;ran simplifiedLesk: &quot; + targetWord + &quot;sense &quot; + k);
<span class="fc" id="L363">					return k;</span>
					//logger.debug(&quot;simplifiedLesk doesn't add value - throwing it away&quot;);
				}
			}
			//logger.debug(&quot;no sense key: &quot; + targetWord);

<span class="nc" id="L369">		return null;</span>
	}
	
	private List&lt;String&gt; getGlossWords(IWord word) {
<span class="fc" id="L373">		String gloss = word.getSynset().getGloss();</span>
<span class="fc" id="L374">		gloss = gloss.toLowerCase();</span>
<span class="fc" id="L375">		gloss = gloss.replace(&quot;;&quot;, &quot;&quot;);</span>
<span class="fc" id="L376">		gloss = gloss.replace(&quot;\&quot;&quot;, &quot;&quot;);</span>
<span class="fc" id="L377">		gloss = gloss.replace(&quot;,&quot;, &quot;&quot;);</span>
<span class="fc" id="L378">		gloss = gloss.replace(&quot;!&quot;, &quot;&quot;);</span>
<span class="fc" id="L379">		gloss = gloss.replace(&quot;(&quot;, &quot;&quot;);</span>
<span class="fc" id="L380">		gloss = gloss.replace(&quot;)&quot;, &quot;&quot;);</span>
<span class="fc" id="L381">		gloss = gloss.replace(&quot;?&quot;, &quot;&quot;);</span>
<span class="fc" id="L382">		return Arrays.asList(gloss.split(&quot;\\s+&quot;));</span>
	}
	
	private List&lt;String&gt; getSynsetWords(IWord word) {
<span class="fc" id="L386">		ArrayList&lt;String&gt; retval = new ArrayList&lt;String&gt;();</span>
		
<span class="fc" id="L388">			ISynset synset = word.getSynset();</span>
<span class="fc bfc" id="L389" title="All 2 branches covered.">	        for (IWord w : synset.getWords()) {</span>
<span class="fc" id="L390">	            retval.add(w.getLemma());</span>
<span class="fc" id="L391">	        }</span>
<span class="fc bfc" id="L392" title="All 2 branches covered.">	        for (ISynsetID relatedSynsetId : synset.getRelatedSynsets()) {</span>
<span class="fc" id="L393">	        	ISynset relatedSynset = getWordnet().getSynset(relatedSynsetId);</span>
<span class="fc bfc" id="L394" title="All 2 branches covered.">	        	for (IWord relatedSynsetWord : relatedSynset.getWords()) {</span>
<span class="fc" id="L395">	        		retval.add(relatedSynsetWord.getLemma());</span>
<span class="fc" id="L396">	        	}</span>
<span class="fc" id="L397">	        }</span>
<span class="fc bfc" id="L398" title="All 2 branches covered.">	        for (IWordID relatedWordId : word.getRelatedWords()) {</span>
<span class="fc" id="L399">	        	IWord relatedWord = getWordnet().getWord(relatedWordId);</span>
<span class="fc" id="L400">	        	retval.add(relatedWord.getLemma());</span>
	        	
<span class="fc" id="L402">	        }</span>

<span class="fc" id="L404">        return retval;</span>
	}
	
	private List&lt;String&gt; removeCommonWords(List&lt;String&gt; list) throws InstantiationException, IllegalAccessException, ClassNotFoundException, IOException {

<span class="fc" id="L409">		Map&lt;String,String&gt; dict = ResourceUtils.getInstance(parameterStore).getDictionary(</span>
				&quot;io/outofprintmagazine/nlp/models/COCA/en_100.txt&quot;
		);
<span class="fc" id="L412">		Iterator&lt;String&gt; listIter = list.iterator();</span>
<span class="fc bfc" id="L413" title="All 2 branches covered.">		while (listIter.hasNext()) {</span>
<span class="fc bfc" id="L414" title="All 2 branches covered.">			if (dict.get(listIter.next()) != null) {</span>
<span class="fc" id="L415">				listIter.remove();</span>
			}
		}
<span class="fc" id="L418">		return list;</span>
	}
	
	//the word itself, all words in the glosses or synset, remove common words
	private List&lt;String&gt; getSenseContextWords(IWord word) throws InstantiationException, IllegalAccessException, ClassNotFoundException, IOException {
<span class="fc" id="L423">		ArrayList&lt;String&gt; retval = new ArrayList&lt;String&gt;();</span>
<span class="fc" id="L424">		retval.add(word.getLemma());</span>
<span class="fc" id="L425">		retval.addAll(getGlossWords(word));</span>
<span class="fc" id="L426">		retval.addAll(getSynsetWords(word));</span>
<span class="fc" id="L427">		return retval;</span>
	}
	
	private List&lt;String&gt; getLemmasAndTokens(List&lt;CoreLabel&gt; words) {
<span class="fc" id="L431">		List&lt;String&gt; retval = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L432" title="All 2 branches covered.">		for (CoreLabel word : words ) {</span>
<span class="fc" id="L433">			retval.add(word.lemma());</span>
<span class="fc" id="L434">			retval.add(word.originalText().toLowerCase());</span>
<span class="fc" id="L435">		}</span>
<span class="fc" id="L436">		return retval;</span>
	}
	
	 private &lt;T&gt; List&lt;T&gt; removeDuplicates(List&lt;T&gt; list) 
	    { 
	  
	        // Create a new LinkedHashSet 
<span class="fc" id="L443">	        Set&lt;T&gt; set = new LinkedHashSet&lt;&gt;(); </span>
	  
	        // Add the elements to set 
<span class="fc" id="L446">	        set.addAll(list); </span>
	  
	        // Clear the list 
<span class="fc" id="L449">	        list.clear(); </span>
	  
	        // add the elements of set 
	        // with no duplicates to the list 
<span class="fc" id="L453">	        list.addAll(set); </span>
	  
	        // return the list 
<span class="fc" id="L456">	        return list; </span>
	    } 
	
	private int computeWordOverlap(List&lt;String&gt; list, List&lt;String&gt; otherList) {
		//logger.debug(&quot;--------Context---------------&quot;);
		//for (String x : list) {
			//logger.debug(x);
		//}
		//logger.debug(&quot;--------Gloss+Related---------------&quot;);
		//for (String x : otherList) {
			//logger.debug(x);
		//}
<span class="fc" id="L468">		int overlap = 0;</span>
<span class="fc bfc" id="L469" title="All 2 branches covered.">		for (String x : list) {</span>
<span class="fc bfc" id="L470" title="All 2 branches covered.">			if (otherList.contains(x)) {</span>
				//String wordFrequency = getTa().getDictionary(dictionaryFileName).get(x);
				//double numerator = 100;
				//if (wordFrequency == null) {
<span class="fc" id="L474">					overlap++;</span>
				//}
				//else {
				//	overlap+=(double) numerator/new Integer(wordFrequency).doubleValue();
				//}
			}
<span class="fc" id="L480">		}</span>
<span class="fc" id="L481">		return overlap;</span>
	}
		
	/*
	 * function SIMPLIFIED LESK(word,sentence) returns best sense of word
	best-sense &lt;- most frequent sense for word
	max-overlap &lt;- 0
	context &lt;- set of words in sentence
	for each sense in senses of word do
	signature &lt;- set of words in the gloss and examples of sense
	overlap &lt;- COMPUTEOVERLAP (signature,context)
	if overlap &gt; max-overlap then
	max-overlap &lt;- overlap
	best-sense &lt;- sense
	end return (best-sense)		
	 */
	private ISenseKey simplifiedLesk(CoreLabel targetWord, List&lt;CoreLabel&gt; contextWords) throws IOException, InstantiationException, IllegalAccessException, ClassNotFoundException {
<span class="fc" id="L498">		ISenseKey retval = null;</span>
<span class="fc" id="L499">		POS pos = tagToPOS(targetWord);</span>
<span class="pc bpc" id="L500" title="1 of 2 branches missed.">		if (pos == null) {</span>
<span class="nc" id="L501">			return retval;</span>
		}
<span class="fc" id="L503">		List&lt;String&gt; expandedContextWords = removeCommonWords(removeDuplicates(getLemmasAndTokens(contextWords)));</span>
<span class="fc" id="L504">		IIndexWord idxWord = getWordnet().getIndexWord(targetWord.lemma(), tagToPOS(targetWord));</span>
<span class="pc bpc" id="L505" title="1 of 2 branches missed.">		if (idxWord != null) {</span>
			//logger.debug(&quot;checking word: &quot; + idxWord.getLemma());
<span class="fc" id="L507">			int maxOverlap = 0;</span>
<span class="fc" id="L508">			int bestMatchIdx = 0;</span>
<span class="fc bfc" id="L509" title="All 2 branches covered.">			for (int i=0; i&lt;idxWord.getWordIDs().size();i++) {</span>
<span class="fc" id="L510">				IWord word = getWordnet().getWord(idxWord.getWordIDs().get(i));</span>
				//logger.debug(&quot;checking sense: &quot; + i);
				//logger.debug(&quot;current best match: &quot; + bestMatchIdx);
<span class="fc" id="L513">				int overlap = computeWordOverlap(expandedContextWords, removeCommonWords(removeDuplicates(getSenseContextWords(word))));</span>
<span class="fc bfc" id="L514" title="All 2 branches covered.">				if (overlap &gt; maxOverlap) {</span>
<span class="fc" id="L515">					maxOverlap = overlap;</span>
<span class="fc" id="L516">					bestMatchIdx = i;</span>
				}
			}
			//logger.debug(&quot;bestMatch was: &quot; + bestMatchIdx);
<span class="fc" id="L520">			retval = getWordnet().getWord(idxWord.getWordIDs().get(bestMatchIdx)).getSenseKey();</span>
			//logger.debug(&quot;senseKey: &quot; + retval);
		}
<span class="fc" id="L523">		return retval;</span>
	}			
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>